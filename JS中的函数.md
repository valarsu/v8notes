# 先上总结

- JS中的函数非常灵活，既可以被调用，还可以作为变量、参数和返回值
- 函数是一种特殊的对象
    - 对象：由一组一组属性和值组成的集合
    - 所以函数也是由一组组值和属性组成的集合
- 函数可以被赋值、作为参数，还可以作为返回值，如果一个函数返回了另外一个函数，那么就应该返回函数所有相关的内容
- 关联内容
    - 函数作为一个对象，它有自己的属性和值，所以函数关联了基础的属性和值
    - 函数之所以成为特殊的对象，这个特殊的地方是函数可以被调用，所以一个函数被调用时，它还需要关联相关的执行上下文

# 函数是JS的一等公民

函数非常灵活，根本原因在于JS中的函数是一种特殊的对象。基于这点，使JS非常容易实现一些特性，比如闭包、函数式编程等。

在JS中，函数可以赋值给一个变量，也可以作为函数的参数，也可以作为函数的返回值。

所以，如果某个编程语言的函数，可以和这个语言的数据类型做一样的事情，就把这个语言中的函数称为一等公民。

### 作用域链

在执行JS函数的过程中，为了实现变量的查找，V8会为其维护一个作用域链，如果函数中使用了某个变量，但是在函数内部又没有定义该便来给你，那么函数就会沿着作用域链去外部的作用域中查找该变量

![1ba2a1cdd2d1ae1f6b79db2a14be6fc9.png](en-resource://database/738:0)

当函数内部引用了外部变量时，使用这个函数进行赋值、传参或者作为返回值，就需要保证这些引用的外部变量是确定存在的，所以虚拟机还要处理函数引用的外部变量

```js

function foo(){
    var number = 1
    function bar(){
        number++
        console.log(number)
    }
    return bar
}
var mybar = foo()
mybar()
```

以上代码，在foo函数中定义了一个新的bar函数，并且bar函数引用了foo函数中的变量number，调用foo函数的时候哦，他会返回bar函数

那么所谓的函数是一等公民就体现在，如果要返回函数的bar给外部，那么即便foo函数执行结束了，其内部定义的number变量也不能被销毁，因为bar函数依然引用了该变量。这也就是闭包。

### JS中的对象

JS不是面向对象语言，因为面向对象语言天生支持封装、继承、多态。而JS并没有直接提供对多态的支持。

JS是基于对象的语言，大部分内容，比如函数、数组都是由对象构成的，而对象在运行时可以动态的修改内容，所以非常灵活。

JS实现继承也和其他OOP语言存在很大差异。OOP语言提供了public、protected、friend、interface等关键字支持继承。而JS只是在对象中添加了原型这个属性，把继承的对象通过原型链连接起来，就实现了继承。

#### 对象的属性值类型

- 原始类型：原始类型的数据，值本身无法被改变，如果修改了原始值，那么V8会返回一个新的原始值，原来的并没有被改变
- 对象类型：对象的属性值也可以是另一个对象
- 函数类型：如果属性值是函数，那么就这个属性就是方法

# 函数的本质

函数是特殊的对象，它和对象一样可以拥有属性和值，但是函数和普通对象有一点不同，那就是函数可以被调用

```js

function foo(){
    var test = 1
}
foo.myName = 1
foo.obj = { x: 1 }
foo.fun = function () { return 0 }
console.log(foo.myName)
foo()
```

上面的代码中，函数可以被设置属性值，也可以被调用

### v8对函数的实现

V8会为函数对象添加两个隐藏属性

![06fbf6edb31238457ad4c8a51e33daa1.png](en-resource://database/736:0)

比如上面的代码，除了正常被赋予的属性，还有两个隐藏属性

- name： 函数名称，匿名函数的name属性值为anonymous
- code：表示函数代码，以字符串的形式存储在内从中，当执行到一个函数调用语句时，V8就从函数对象中取出code属性值，然后解释执行这段代码

